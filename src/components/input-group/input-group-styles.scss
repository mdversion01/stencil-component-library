// =============================================
// Tokens
// =============================================
$danger: #b30009;
$invalid-border: var(--bs-form-invalid-border-color, #b30009);

$radius-sm: 0.25rem;
$radius-md: 0.375rem;
$radius-lg: 0.5rem;


// =============================================
// Helpers
// =============================================
@mixin input-group-btn-radii($r) {
  .btn {
    &:first-child {
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
      border-top-left-radius: $r;
      border-bottom-left-radius: $r;
    }
    &:last-child {
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
      border-top-right-radius: $r;
      border-bottom-right-radius: $r;
    }
  }
}

/* Generate label padding when a .form-group contains a matching input-group.
   $label:  string selector for the label target
   $pt:     padding-top value
   $groups: list of string selectors for the input-group(s) */
@mixin label-pt-when-has-group($label, $pt, $groups) {
  // Stacked: direct child input-group
  @each $g in $groups {
    .form-group:has(> #{$g}) > #{$label} {
      padding-top: $pt !important;
    }
  }
  // Row (horizontal/inline): input-group anywhere under the row.form-group
  @each $g in $groups {
    .row.form-group:has(#{$g}) #{$label} {
      padding-top: $pt !important;
    }
  }
}


// =============================================
// Invalid states
// =============================================
.input-group-text.is-invalid {
  border-color: $invalid-border;
  color: $danger;
}

.input-group.is-invalid {
  .btn { border-color: $invalid-border; }
}


// =============================================
// Input group buttons + sizes
// =============================================
.input-group {
  .btn {
    height: 100%;
    z-index: 0 !important;
  }

  // default (md)
  @include input-group-btn-radii($radius-md);

  &.input-group-sm { @include input-group-btn-radii($radius-sm); }
  &.input-group-lg { @include input-group-btn-radii($radius-lg); }
}

// Font-size normalization per group size
.input-group > .form-control        { font-size: 1rem !important; }
.input-group-xs > .form-control     { font-size: 0.75rem !important; }
.input-group-sm > .form-control     { font-size: 0.875rem !important; }
.input-group-lg > .form-control     { font-size: 1.125rem !important; }


// =============================================
// Smart label padding via :has()
// (single block; everything generated by a mixin)
// =============================================
@supports selector(:has(*)) {
  // Define group-size selectors as strings
  $groups-lg:   ('div.input-group.input-group-lg', 'div.input-group.input-lg');
  $groups-sm:   ('div.input-group.input-group-sm', 'div.input-group.input-sm');
  $groups-base: ('div.input-group');

  // ----- Large groups -----
  // label-sm -> 13px
  @include label-pt-when-has-group('label.form-control-label.label-sm', 13px, $groups-lg);
  // default label -> 11px
  @include label-pt-when-has-group('label.form-control-label',         11px, $groups-lg);
  // label-xs -> 15px
  @include label-pt-when-has-group('label.form-control-label.label-xs', 15px, $groups-lg);
  // label-lg -> 10px
  @include label-pt-when-has-group('label.form-control-label.label-lg', 10px, $groups-lg);

  // ----- Small groups -----
  // label-xs -> 7px
  @include label-pt-when-has-group('label.form-control-label.label-xs', 7px,  $groups-sm);
  // default label -> 3px
  @include label-pt-when-has-group('label.form-control-label',          3px,  $groups-sm);
  // label-sm -> 6px
  @include label-pt-when-has-group('label.form-control-label.label-sm', 4px,  $groups-sm);
  // label-lg -> 1px
  @include label-pt-when-has-group('label.form-control-label.label-lg', 4px,  $groups-sm);

  // ----- Base (any) input-group -----
  // label-lg -> 4px
  @include label-pt-when-has-group('label.form-control-label.label-lg', 4px,  $groups-base);
  // label-sm -> 10px
  @include label-pt-when-has-group('label.form-control-label.label-sm', 10px, $groups-base);
  // label-xs -> 11px
  @include label-pt-when-has-group('label.form-control-label.label-xs', 11px, $groups-base);
  // default label -> 8px
  @include label-pt-when-has-group('label.form-control-label',          8px,  $groups-base);
}
