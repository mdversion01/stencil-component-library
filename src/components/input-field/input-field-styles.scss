// =============================================
// Tokens
// =============================================
$danger:    #b30009;

$label-xs:  0.75rem;
$label-sm:  0.875rem;
$label-lg:  1.125rem;

// Helpers: input-size selectors & wrappers we care about (as STRINGS)
$inputs-sm: (
  'input.form-control.form-control-sm',
  'input.form-control.input-sm'
);

$inputs-lg: (
  'input.form-control.form-control-lg',
  'input.form-control.input-lg'
);

$inputs-base: (
  'input.form-control'
);

$input-wrappers: (
  '.ac-input-container',
  '.input-container'
);

$ms-input-wrappers: (
  '.ac-input-container-multi'
);

// =============================================
// Mixins
// =============================================
@mixin placeholder-color($c) {
  &::placeholder { color: $c !important; }
}

/* Generate padding-top on the label when a form-group contains a given input. */
@mixin label-pt-when-has($label-sel, $pt, $input-selectors) {
  // Stacked: direct child input
  @each $inp in $input-selectors {
    .form-group:has(> #{$inp}) > #{$label-sel} { padding-top: $pt !important; }
  }

  // Stacked: input inside wrapper
  @each $inp in $input-selectors {
    @each $wrap in $input-wrappers {
      .form-group:has(#{$wrap} #{$inp}) > #{$label-sel} { padding-top: $pt !important; }
    }
  }

  // Row (horizontal/inline): input anywhere in the row.form-group
  @each $inp in $input-selectors {
    .row.form-group:has(#{$inp}) #{$label-sel} { padding-top: $pt !important; }
    @each $wrap in $ms-input-wrappers {
      .row.form-group:has(#{$wrap} #{$inp}) #{$label-sel} { padding-top: calc($pt - 3px) !important; }
    }
  }

  @each $inp in $input-selectors {
    .row.form-group:has(#{$inp}) #{$label-sel} { padding-top: $pt !important; }
    @each $wrap in $input-wrappers {
      .row.form-group:has(#{$wrap} #{$inp}) #{$label-sel} { padding-top: $pt !important; }
    }
  }
}

// =============================================
// Base label & control styles
// =============================================
label,
.label { margin-bottom: 0.25rem !important; }

.label-xs { font-size: $label-xs !important; }
.label-sm { font-size: $label-sm !important; }
.label-lg { font-size: $label-lg !important; }

.form-control-lg { font-size: $label-lg !important; }

.invalid-feedback { font-size: 0.75rem !important; }

// Invalid input placeholder color
.was-validated .form-control:invalid,
.form-control.is-invalid { @include placeholder-color($danger); }

// =============================================
// Inline / Horizontal layout label rows
// =============================================
.horizontal label,
.inline label {
  display: flex;
  align-items: center;
  justify-content: left;
  margin-bottom: 0 !important;
  padding: 0 !important;
  position: relative;
}

.horizontal label.align-right { justify-content: right; }

.inline .col-form-label { margin-right: 0.5rem !important; }

.inline .form-group .form-control-label,
.inline .form-group label {
  margin-bottom: 0;
  white-space: nowrap;
  padding: 0 0.5rem;
}

.horizontal .form-group .form-control-label,
.horizontal .form-group label {
  margin-bottom: 0;
  white-space: normal;
}

/* Size-aligned top padding baseline */
.inline,
.horizontal {
  .form-control-label { align-items: start !important; padding-top: 6px !important; }
  .label-xs          { align-items: start !important; padding-top: 4px !important; }
  .label-sm          { align-items: start !important; padding-top: 5px !important; }
  label              { align-items: start !important; padding-top: 7px !important; }
  .label-lg          { align-items: start !important; padding-top: 9px !important; }

  .ac-multi-select-container .input-group .form-control { min-width: 240px; }
}

.horizontal .form-group .form-control-label.invalid,
.inline .form-group .form-control-label.invalid { position: relative; }

// =============================================
// Responsive tweaks
// =============================================
@media (max-width: 575px) {
  .row > * { flex-shrink: 1 !important; }

  .horizontal label {
    display: block;
    justify-content: left;
  }

  .horizontal label,
  .inline label { margin-bottom: 0.25rem !important; }
}

// =============================================
// Smart label padding via :has()
// =============================================
@supports selector(:has(*)) {
  // Small input + large label
  @include label-pt-when-has('label.form-control-label.label-lg', 2px, $inputs-sm);

  // Small input + xs label
  @include label-pt-when-has('label.form-control-label.label-xs', 6px, $inputs-sm);

  // Small input + sm label
  @include label-pt-when-has('label.form-control-label.label-sm', 5px, $inputs-sm);

  // Large input + xs label
  @include label-pt-when-has('label.form-control-label.label-xs', 14px, $inputs-lg);

  // Large input + sm label
  @include label-pt-when-has('label.form-control-label.label-sm', 13px, $inputs-lg);

  // Large input + lg label
  @include label-pt-when-has('label.form-control-label.label-lg', 8px, $inputs-lg);

  // Large input + default label
  @include label-pt-when-has('label.form-control-label', 10px, $inputs-lg);

  // Base input + default label
  @include label-pt-when-has('label.form-control-label', 8px, $inputs-base);

  // Base input + xs label
  @include label-pt-when-has('label.form-control-label.label-xs', 11px, $inputs-base);

  // Base input + sm label
  @include label-pt-when-has('label.form-control-label.label-sm', 10px, $inputs-base);

  // Base input + lg label
  @include label-pt-when-has('label.form-control-label.label-lg', 4px, $inputs-base);
}
