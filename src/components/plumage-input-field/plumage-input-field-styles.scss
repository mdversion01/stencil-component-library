// =============================================
// Tokens
// =============================================
$danger: #b30009;

$label-sizes: (
  xs: (font: 0.75rem,  pad: 4px),
  sm: (font: 0.875rem, pad: 7px),
  lg: (font: 1.125rem, pad: 11px),
  base: (pad: 7px),
);

// For :has() rules
$inputs-sm: (
  'input.form-control.form-control-sm',
  'input.form-control.input-sm'
);

$inputs-lg: (
  'input.form-control.form-control-lg',
  'input.form-control.input-lg'
);

$inputs-base: (
  'input.form-control'
);

$input-wrappers: (
  '.ac-input-container',
  '.input-container'
);

// =============================================
// Mixins
// =============================================
@mixin placeholder-color($c) {
  &::placeholder { color: $c !important; }
}

/* Generate padding-top on the LABEL when a container contains a matching INPUT.
   $scope lets us prefix all selectors (e.g., ".plumage "). */
@mixin label-pt-when-has($scope, $label-sel, $pt, $input-selectors) {
  // Stacked: direct child input
  @each $inp in $input-selectors {
    #{$scope}.form-group:has(> #{$inp}) > #{$label-sel} {
      padding-top: $pt !important;
    }
  }

  // Stacked: input inside wrapper
  @each $inp in $input-selectors {
    @each $wrap in $input-wrappers {
      #{$scope}.form-group:has(#{$wrap} #{$inp}) > #{$label-sel} {
        padding-top: $pt !important;
      }
    }
  }

  // Row (horizontal/inline): input anywhere under the row.form-group
  @each $inp in $input-selectors {
    #{$scope}.row.form-group:has(#{$inp}) #{$label-sel} {
      padding-top: $pt !important;
    }
    @each $wrap in $input-wrappers {
      #{$scope}.row.form-group:has(#{$wrap} #{$inp}) #{$label-sel} {
        padding-top: $pt !important;
      }
    }
  }
}

// =============================================
// Base: .plumage
// =============================================
.plumage {
  // -------- Labels (sizes) --------
  @each $key, $vals in $label-sizes {
    @if $key != base {
      .label-#{$key} {
        font-size: map-get($vals, font) !important;
      }
    }
  }

  // -------- Containers & Layout --------
  .input-container {
    position: relative;
    text-align: left;

    // within horizontal/inline layouts
    .horizontal &,
    .inline & {
      padding: 0 15px;
    }
  }

  .form-group.input-container { margin-bottom: 0.25rem; }

  label {
    display: inline-block;
    position: relative;
    margin-bottom: 0.5rem;

    .horizontal &,
    .inline & {
      display: flex;
      align-items: center;
      justify-content: left;
      margin-bottom: 0;
    }

    .horizontal &.align-right { justify-content: right; }
  }

  .form-group {
    .form-control-label,
    label {
      font-weight: 400;
      line-height: 1.1;
      margin-bottom: 0;
    }
  }

  // Row-aligned label padding baselines
  .inline .form-control-label,
  .horizontal .form-control-label {
    align-items: flex-start !important;
    padding-top: 3px !important; // base control-label offset
  }

  // Invalid state (kept for future fine-tune)
  .inline .form-group .form-control-label.invalid,
  .horizontal .form-group .form-control-label.invalid {
    position: relative;
    align-items: normal;
  }

  // Fine-tune per-size label padding in row layouts from the map
  .inline,
  .horizontal {
    .label-xs {
      align-items: flex-start !important;
      padding-top: map-get(map-get($label-sizes, xs), pad) !important;
    }
    .label-sm {
      align-items: flex-start !important;
      padding-top: map-get(map-get($label-sizes, sm), pad) !important;
    }
    .label-lg {
      align-items: flex-start !important;
      padding-top: map-get(map-get($label-sizes, lg), pad) !important;
    }
    label {
      align-items: flex-start !important;
      padding-top: map-get(map-get($label-sizes, base), pad) !important;
    }

    // Multi-select input min width
    .ac-multi-select-container .input-group .form-control { min-width: 240px; }
  }

  // -------- Inputs --------
  .form-control {
    background-color: transparent;
    background-clip: padding-box;
    border: 0 solid #cacaca;
    border-radius: 0;
    color: #383838;
    display: block;
    width: 100%;
    font-weight: 400;
    line-height: 1.2;
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;

    &:focus {
      background-color: transparent;
      border-color: #9bc4f6;
      color: #383838;
      outline: 0;
      box-shadow: 0 0 0 0.2rem rgb(0 123 255 / 25%);
    }

    &:disabled { background-color: #f5f5f5; }

    &.is-invalid,
    &:invalid {
      padding-right: calc(1.5em + 0.75rem);
      background-repeat: no-repeat;
      background-position: center right calc(-1em + 1.5rem);
      background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23e34850' viewBox='0 0 24 24'%3e%3cpath d='M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10S2 17.514 2 12 6.486 2 12 2zm0 18c4.411 0 8-3.589 8-8s-3.589-8-8-8-8 3.589-8 8 3.589 8 8 8z'/%3e%3cpath d='M13 7h-2v6h2V7zm0 8h-2v2h2v-2z'/%3e%3c/svg%3e");
    }

    &.is-invalid { @include placeholder-color($danger); }
  }

  .input-container input {
    border: none;
    font-weight: 300;
    line-height: 1.2;
    transition: border-color 0.25s ease;

    &:focus {
      box-shadow: none;
      outline: none;
    }
  }

  // -------- Underline (focus bar) --------
  .b-underline {
    width: 100%;
    height: 1px;
    position: relative;
    display: block;
    background-color: #ccc;
    transition: 0.4s;

    &.invalid {
      background-color: #b30009;
      height: 1px;
    }
  }

  .b-focus {
    position: absolute;
    bottom: 0;
    left: 50%;
    width: 0;
    height: 1px;
    background-color: #2680eb;
    transition: 0.4s;

    &.disabled,
    &:disabled { background-color: transparent; }

    &.invalid {
      background-color: #b30009;
      height: 1px;
    }
  }

  // -------- Validation messages --------
  .invalid-feedback {
    margin-top: 0.25rem;
    font-size: 0.75rem;
    color: #b30009;
  }

  .invalid { color: #b30009; }
}

// =============================================
// Responsive tweaks
// =============================================
@media (max-width: 575px) {
  .plumage .row > * { flex-shrink: 1 !important; }

  .plumage .horizontal label {
    display: block;
    justify-content: left;
  }

  .plumage .horizontal label,
  .plumage .inline label {
    margin-bottom: 0.25rem !important;
  }
}

// =============================================
// Smart label padding via :has()
// Keep selectors as *strings*, interpolate in the mixin.
// =============================================
@supports selector(:has(*)) {
  $scope: '.plumage ';

  // Your requested combos/values:
// Small input + large label
  @include label-pt-when-has($scope, 'label.form-control-label.label-lg', 6px, $inputs-sm);

  // Small input + xs label
  @include label-pt-when-has($scope, 'label.form-control-label.label-xs', 6px, $inputs-sm);

  // Small input + sm label
  @include label-pt-when-has($scope, 'label.form-control-label.label-sm', 5px, $inputs-sm);

  // Large input + xs label
  @include label-pt-when-has($scope, 'label.form-control-label.label-xs', 16px, $inputs-lg);

  // Large input + sm label
  @include label-pt-when-has($scope, 'label.form-control-label.label-sm', 13px, $inputs-lg);

  // Large input + lg label
  @include label-pt-when-has($scope, 'label.form-control-label.label-lg', 8px, $inputs-lg);

  // Large input + default label
  @include label-pt-when-has($scope, 'label.form-control-label', 10px, $inputs-lg);

  // Base input + default label
  @include label-pt-when-has($scope, 'label.form-control-label', 8px, $inputs-base);

  // Base input + xs label
  @include label-pt-when-has($scope, 'label.form-control-label.label-xs', 13px, $inputs-base);

  // Base input + sm label
  @include label-pt-when-has($scope, 'label.form-control-label.label-sm', 10px, $inputs-base);

  // Base input + lg label
  @include label-pt-when-has($scope, 'label.form-control-label.label-lg', 4px, $inputs-base);

}
